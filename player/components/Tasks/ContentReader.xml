<?xml version = "1.0" encoding = "utf-8" ?> 

<!--********** Copyright 2016 Roku Corp.  All Rights Reserved. **********-->

<component name = "ContentReader" extends = "Task" >
 
    <interface>
        <field id = "contenturi" type = "uri" />
        <field id = "content" type = "node" />
    </interface> 

	<script type = "text/brightscript" uri = "pkg:/source/AdManagement/Utils/YSDebugLog.brs" />

    <script type = "text/brightscript" >
    <![CDATA[

        sub init()
            m.top.functionName = "getcontent"
            YO_LOGLEVEL(YospaceVerbosity().WARNING)
        end sub

        sub getcontent()
            content = createObject("roSGNode", "ContentNode")

            contentxml = createObject("roXMLElement")

            ' uncomment/conditionalize for development package XML transfers (pkg:/server/foo.xml)
            xmlstring = ReadAsciiFile(m.top.contenturi)
            contentxml.parse(xmlstring)

            ' uncomment/conditionalize for published channel Internet XML transfers (http://serverdomain/foo.xml)
            'readInternet = createObject("roUrlTransfer")
            'readInternet.setUrl(m.top.contenturi)
            'rawxml = readInternet.GetToString()
            'contentxml.parse(rawxml)

            if contentxml.getName()="Content"
                for each item in contentxml.GetNamedElements("Stream")
                    YO_DEBUG("ContentReader::GetContent - Processing stream item")
                    itemcontent = content.createChild("ContentNode")
                    itemcontent.setFields(item.getAttributes())
                end for
            end if

            YO_DEBUG("ContentReader::GetContent - Setting content")
            m.top.content = content
        end sub

        sub gettargets()
            content = createObject("roSGNode", "ContentNode")

            contentxml = createObject("roXMLElement")

            ' uncomment/conditionalize for development package XML transfers (pkg:/server/foo.xml)
            xmlstring = ReadAsciiFile(m.top.contenturi)
            contentxml.parse(xmlstring)

            ' uncomment/conditionalize for published channel Internet XML transfers (http://serverdomain/foo.xml)
            'readInternet = createObject("roUrlTransfer")
            'readInternet.setUrl(m.top.contenturi)
            'rawxml = readInternet.GetToString()
            'contentxml.parse(rawxml)

            if contentxml.getName()="Groups"
                for each item in contentxml.GetNamedElements("Group")
                    itemcontent = content.createChild("ContentNode")
                    itemcontent.setFields(item.getAttributes())
                end for
            end if

            YO_DEBUG("ContentReader::GetTargets - Setting content")
            m.top.content = content
        end sub

    ]]>
    </script>

</component>
